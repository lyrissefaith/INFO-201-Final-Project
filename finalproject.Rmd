---
title: "finalproject"
output: html_document
date: "2023-11-30"
---
```{r}
library(tidyverse)
```
# Final Project (Population vs. Obesity by State)

## Intro
### Orignial Questions: 
### 1. Are there any correlations between a state’s population size and its obesity percentage? For example, do more populous states tend to have higher or lower obesity rates?


### 2. What is the state with the highest obesity percentage, and how does its population compare to other states with lower obesity rates? Is there a relationship between high obesity and a larger or smaller population?


### 3. Are there any significant changes in state obesity percentages over time, and how do these changes relate to changes in state populations? 


### 4.Are there any states where obesity has been increasing or decreasing at a faster rate compared to changes in population size?


## Data cleaning


### Read in our data and clean population data for 2010-2019

```{r}
pop_2010_2019 <- read_delim("../Data/pop_2010_2019.csv")
short_pop_10_19 <- subset(pop_2010_2019, select = c("Area", "2015", "2016", "2017", "2018", "2019"))
```

### Read in our data and clean population data for 2020-2022

```{r}
pop_2020_2022 <- read_delim("../Data/pop_2020_2022.csv")
short_pop_20_22 <- subset(pop_2020_2022, select = c("NAME", "POPESTIMATE2020", "POPESTIMATE2021", "POPESTIMATE2022"))
colnames(short_pop_20_22) <- c("Area", "2020", "2021", "2022")
```

### Merging population data

```{r}
mergedpop <- left_join(short_pop_10_19, short_pop_20_22)
```

### Cleaning merged population data

```{r}
popLong <- pivot_longer(mergedpop,
                        !c(Area),
                        names_to="Year",
                        values_to="Population") %>%
  mutate(Year = as.numeric(sub("X", "", Year)))
head(popLong, 4)
```

### Read in our data and clean obesity data for 2015-2022

```{r}
obesity_data <- read_delim("../Data/National_Obesity_By_State.csv")
short_obesity_data <- subset(obesity_data, select = c("NAME", "Obesity", "Year"))
colnames(short_obesity_data) <- c("Area","Obesity", "Year")
```

### Merging population and obesity data

```{r}
finalMerge <- left_join(popLong, short_obesity_data) 
```

This is our dataset, population data from 2015-2022 and obesity percentages per state: **mergedObesityPop**. 

## Questions & Data
### 1. Are there any correlations between a state’s population size and its obesity percentage? For example, do more populous states tend to have higher or lower obesity rates?
```{r}
#Highest and lowest obesity percentage per state

ob2015_data <- mergedObesityPop[mergedObesityPop$type == "obesity", ]
ob2015 <- ob2015_data[, "2015"]

highest_obesity_state <- ob2015_data$area[which.max(ob2015)]
highest_obesity_percentage <- max(ob2015)
lowest_obesity_state <- ob2015_data$area[which.min(ob2015)]
lowest_obesity_percentage <- min(ob2015)

cat("The state with the highest obesity percentage in 2015 is", highest_obesity_state, "with a percentage of",  highest_obesity_percentage, "\n")
cat("The state with the lowest obesity percentage in 2015 is", lowest_obesity_state, "with a percentage of", lowest_obesity_percentage, "\n")

#trends up to 2022

years <- as.character(2015:2022)
obesity_trend_data <- obesity_data[, c("area", "type", years)]
find_trend <- function(state) {
  state_data <- obesity_trend_data[obesity_trend_data$area == state, ]
  trend_values <- as.numeric(state_data[, years])
  return(trend_values)
}
calculate_yearly_change <- function(trend_values) {
  annual_change <- c(0, diff(trend_values))
  return(annual_change)
}

highest_obesity_trend <- find_trend(highest_obesity_state)
highest_obesity_annual_change <- calculate_yearly_change(highest_obesity_trend)

lowest_obesity_trend <- find_trend(lowest_obesity_state)
lowest_obesity_annual_change <- calculate_yearly_change(lowest_obesity_trend)

average_annual_change_highest <- mean(highest_obesity_annual_change[2:8])
average_annual_change_lowest <- mean(lowest_obesity_annual_change[2:8])
rounded_high <- round(average_annual_change_highest, digits = 2)
rounded_low <- round(average_annual_change_lowest, digits = 2)

cat("Average annual change in obesity percentage for", highest_obesity_state, "from 2016 to 2022:", rounded_high, "\n")
cat("Average annual change in obesity percentage for", lowest_obesity_state, "from 2016 to 2022:", rounded_low, "\n")

#should I print the original 2015 and 2022 for each of these so I can see that they are increasing regardless?

#if we want to include a plot:
df <- data.frame(
  year = rep(2016:2022, 2),
  state = rep(c(highest_obesity_state, lowest_obesity_state), each = 7),
  annual_change = c(highest_obesity_annual_change[2:8], lowest_obesity_annual_change[2:8])
)

ggplot(df, aes(x = year, y = annual_change, color = state)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +  
  labs(
    title = "Annual Change in Obesity Percentage (2016-2022)",
    x = "Year",
    y = "Annual Change in Obesity Percentage",
    color = "State"
  ) +
  theme_minimal()
```
This data shows that on average, as the years progress, Colorado has decreased their obesity levels by 0.67 and Louisiana continues to increase there obesity percentage by around 0.2.


### 2. What is the state with the highest obesity percentage, and how does its population compare to other states with lower obesity rates? Is there a relationship between high obesity and a larger or smaller population?
```{r}


```

Highest obesity percentage per year: 
2015: Louisiana
2016: West Virginia
2017: West Virginia
2018: West Virginia & Mississippi (tied)
2019: Mississippi
2020: Mississippi
2021: West Virginia
2022: West Virginia


### 3. Are there any significant changes in state obesity percentages over time, and how do these changes relate to changes in state populations? 
#### I'm not sure if this is right because when I do it in another way where I graph outliers, there are no outliers. But when I write the code in this way it shows two states that have outling results. The graph is a straight line slope though, so I don't know if it has no outliers? Might have to re-do after looking at question 2? 

```{r}
# Changes in obesity rates for each state
obesity_changes <- mergedObesityPop %>%
  filter(type == "obesity") %>%
  group_by(area) %>%
  summarise(obesity_change = `2022` - `2015`)

# Changes in population for each area 
population_changes <- mergedObesityPop %>%
  filter(type == "population") %>%
  group_by(area) %>%
  summarise(population_change = `2022` - `2015`)

# Outliers in obesity rate changes
obesity_outliers <- obesity_changes %>%
  filter(abs(scale(obesity_change)) > 2)  

# Merged the population changes with obesity outliers
population_vs_obesity_outliers <- inner_join(population_changes, obesity_outliers, by = "area")
print(population_vs_obesity_outliers)
```
The states with significant outlier changes in obesity rates are District of Columbia and Minnesota. 

District of Columbia had a decrease in population from 2015 to 2022. 
The obesity change - 0.6 indicates a decrease in obesity rate. 
Minnesota saw a big growth in population from 2015 to 2022 resulting in a big increase in obesity rate. 
Increase in population often result in a increase in obesity rate. 

```{r}
ggplot(population_vs_obesity_outliers, aes(x = population_change, y = obesity_change)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(title = "Relationship between Population Change and Obesity Outliers", x = "Population Change", y = "Obesity Change")
```
The graph shows the relation of changes in state populations to chanages in obesity percentates over time. 

### 4.Are there any states where obesity has been increasing or decreasing at a faster rate compared to changes in population size?
```{r}

```

## Graphs
```{r}
ggplot(short_obesity_data, aes(Year, Obesity, col = Area)) +
  geom_line(linewidth = 0.5)+
  labs(x="Years", y="Obesity Percentage of State")
  
```
geom_smooth(method = "lm", se = FALSE, alpha = 0.5)




