---
title: "finalproject"
output: html_document
date: "2023-11-30"
---
```{r}
library(tidyverse)
```
# Final Project (Population vs. Obesity by State)

## Intro
### Orignial Questions: 
### 1. Are there any correlations between a state’s population size and its obesity percentage? For example, do more populous states tend to have higher or lower obesity rates?


### 2. What is the state with the highest obesity percentage, and how does its population compare to other states with lower obesity rates? Is there a relationship between high obesity and a larger or smaller population?


### 3. Are there any significant changes in state obesity percentages over time, and how do these changes relate to changes in state populations? 


### 4.Are there any states where obesity has been increasing or decreasing at a faster rate compared to changes in population size?


## Data cleaning


### Read in our data and clean population data for 2010-2019

```{r}
pop_2010_2019 <- read_delim("../Data/pop_2010_2019.csv")
short_pop_10_19 <- subset(pop_2010_2019, select = c("Area", "2015", "2016", "2017", "2018", "2019"))
```

### Read in our data and clean population data for 2020-2022

```{r}
pop_2020_2022 <- read_delim("../Data/pop_2020_2022.csv")
short_pop_20_22 <- subset(pop_2020_2022, select = c("NAME", "POPESTIMATE2020", "POPESTIMATE2021", "POPESTIMATE2022"))
colnames(short_pop_20_22) <- c("Area", "2020", "2021", "2022")
```

### Merging population data

```{r}
mergedpop <- left_join(short_pop_10_19, short_pop_20_22)
```

### Cleaning merged population data

```{r}
popLong <- pivot_longer(mergedpop,
                        !c(Area),
                        names_to="Year",
                        values_to="Population") %>%
  mutate(Year = as.numeric(sub("X", "", Year)))
head(popLong, 4)
```

### Read in our data and clean obesity data for 2015-2022

```{r}
obesity_data <- read_delim("../Data/National_Obesity_By_State.csv")
short_obesity_data <- subset(obesity_data, select = c("NAME", "Obesity", "Year"))
colnames(short_obesity_data) <- c("Area","Obesity", "Year")
```

### Merging population and obesity data

```{r}
finalMerge <- left_join(popLong, short_obesity_data) 
```

## Questions & Data
## 1. Are there any correlations between a state’s population size and its obesity percentage? For example, do more populous states tend to have higher or lower obesity rates?
```{r}
#Highest and lowest obesity percentage per state

ob2015_data <- finalMerge[finalMerge$Year == "2015", ]
ob2015 <- ob2015_data[, "Obesity"]

highest_obesity_state <- ob2015_data$Area[which.max(ob2015$Obesity)]
highest_obesity_percentage <- max(ob2015$Obesity)
lowest_obesity_state <- ob2015_data$Area[which.min(ob2015$Obesity)]
lowest_obesity_percentage <- min(ob2015$Obesity)

cat("The state with the highest obesity percentage in 2015 is", highest_obesity_state, "with a percentage of",  highest_obesity_percentage, "\n")
cat("The state with the lowest obesity percentage in 2015 is", lowest_obesity_state, "with a percentage of", lowest_obesity_percentage, "\n")

#trends up to 2022

highest_obesity_data <- finalMerge[finalMerge$Area == highest_obesity_state, ]
lowest_obesity_data <- finalMerge[finalMerge$Area == lowest_obesity_state, ]

calculate_annual_change <- function(state_data) {
  annual_change <- c(0, diff(state_data$Obesity) / diff(state_data$Year))
  return(annual_change)
}

highest_obesity_annual_change <- calculate_annual_change(highest_obesity_data)
lowest_obesity_annual_change <- calculate_annual_change(lowest_obesity_data)

library(ggplot2)
combined_data <- rbind(highest_obesity_data, lowest_obesity_data)
combined_annual_change <- calculate_annual_change(combined_data)
plot_data <- data.frame(
  year = rep(2015:2022, 2),
  state = rep(c(highest_obesity_state, lowest_obesity_state), each = 8),
  annual_change = c(highest_obesity_annual_change, lowest_obesity_annual_change)
)
ggplot(plot_data, aes(x = year, y = annual_change, color = state)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +  
  labs(
    title = "Annual Change in Obesity Percentage (2015-2022)",
    x = "Year",
    y = "Annual Change in Obesity Percentage",
    color = "State"
  ) +
  theme_minimal()
```
This data shows that on average, as the years progress, Colorado has decreased their obesity levels by 0.67 and Louisiana continues to increase there obesity percentage by around 0.2.


## 2. What is the state with the highest obesity percentage, and how does its population compare to other states with lower obesity rates? Is there a relationship between high obesity and a larger or smaller population?
```{r, echo=FALSE}
high <- finalMerge %>%
  group_by(Year) %>%
  slice_max(Obesity) %>%
  ungroup()
low <- finalMerge %>%
  group_by(Year) %>%
  slice_min(Obesity) %>%
  ungroup()
```

**Highest obesity percentage per year:**

|     State | Year | Obesity Rate |
|  -------- | :------: | :----:   |
|Louisiana  |   2015   |  36.2    |
|Mississippi|   2016   |  37.3    |
|West Virginia|   2017   |  38.1    |
|West Virginia|   2018   |  39.5      |
|Mississippi|   2018   |  39.5    |
|Mississippi|   2019   |   40.8   |
|Mississippi|   2020   |  39.7    |
|West Virginia|   2021   |   40.6   |
|West Virginia|   2022   |   41.6   |

**Lowest obesity percentage per year:**

|     State | Year | Obesity Rate |
|  -------- | :------: | :----:   |
|Colorado   |   2015   |  20.2    |
|Colorado   |   2016   |  22.3    |
|Colorado   |   2017   |  22.6    |
|Colorado   |   2018   |  23      |
|Colorado   |   2019   |  23.8    |
|District of Columbia|   2019   |   23.8   |
|Colorado   |   2020   |  24.2    |
|District of Columbia|   2021   |   24.7   |
|District of Columbia|   2022   |   21.5   |

```{r, echo=FALSE}
merge_high_low <- full_join(high, low, by = join_by(Area, Year, Population, Obesity))

ggplot(merge_high_low, aes(Year, Obesity, col = Area)) +
  geom_point() +
  geom_line() +
  labs(title = "High VS Low Obesity Rates ", x="Years", y="Obesity Rates")
```
```{r, echo=FALSE}
ggplot(merge_high_low, aes(Year, Population, col = Area)) +
  geom_point() + 
  geom_line() +
  labs(title = "Population Growth", x="Years", y="Population")

```


## 3. Are there any significant changes in state obesity percentages over time, and how do these changes relate to changes in state populations? 
#### I'm not sure if this is right because when I do it in another way where I graph outliers, there are no outliers. But when I write the code in this way it shows two states that have outling results. The graph is a straight line slope though, so I don't know if it has no outliers? Might have to re-do after looking at question 2? 

```{r}
# Changes in obesity rates for each state
obesity_changes <- finalMerge %>%
  group_by(Area) %>%
  summarize(obesity_change = last(Obesity) - first(Obesity))

# Changes in population for each area 
population_changes <- finalMerge %>%
  group_by(Area) %>%
  summarize(population_change = last(Population) - first(Population))

# Outliers in obesity rate changes
obesity_outliers <- obesity_changes %>%
  filter(abs(scale(obesity_change)) > 2)  

# Merged the population changes with obesity outliers
population_vs_obesity_outliers <- inner_join(population_changes, obesity_outliers, by = "Area")
population_vs_obesity_outliers
```

The state with a significant changes in obesity rates is Minnesota. 

Minnesota saw a big growth in population from 2015 to 2022 resulting in a big increase in obesity rate. 
Increase in population often result in a increase in obesity rate. 


## 4.Are there any states where obesity has been increasing or decreasing at a faster rate compared to changes in population size? Does the state with the highest/lowest obesity growth have the highest/lowest population growth as well and vice versa?
```{r, echo=FALSE}
mergeLong <- finalMerge %>%
  pivot_longer(!Area&!Year, names_to = "type", values_to = "data")

mergeWide <- mergeLong %>%
  pivot_wider(names_from = "Year", values_from = data)

obesity_wide <- mergeWide %>%
  filter(type == "Obesity", na.rm = TRUE)

population_wide <- mergeWide %>%
  filter(type == "Population", na.rm = TRUE)

mutateWide <- obesity_wide %>%
  filter(na.rm = TRUE) %>%
  mutate(obesity_wide, ob_growth = (((obesity_wide$"2022" - obesity_wide$'2015')/(obesity_wide$'2015'))*100), na.rm = TRUE) %>%
  mutate(population_wide, pop_growth = (((population_wide$"2022" - population_wide$'2015')/(population_wide$'2015'))*100), na.rm = TRUE) %>%
  arrange(desc(ob_growth))%>%
  select(Area, "2015", "2022", ob_growth, pop_growth)

growthDf <- mutateWide %>%
  select(Area, ob_growth, pop_growth)
colnames(growthDf)[2] <- "Obesity"
colnames(growthDf)[3] <- "Population"
growthLong <- growthDf %>%
  pivot_longer(!Area, names_to = "type", values_to = "growth_poc")

finalData <- left_join(mergeWide, growthLong)
finalData

head(mutateWide, 5)
tail(mutateWide, 7)
```

### Obesity Growth (percentage growth)

#### Graph 1: Comparing growth of obesity of largest and smallest growth
```{r, echo=FALSE}
mergeLong %>%
  filter(type == "Obesity", Area %in% c("Minnesota", "District of Columbia"), na.rm = TRUE)%>%
  group_by(Area) %>%
  ggplot(aes(Year, data, col = Area)) +
  geom_line(size = 0.8) +
  labs(x="Years", y="Obesity from 2015-2022")+
  geom_smooth(method = "lm", se = FALSE, alpha = 0.3, size = 0.5)
```

We can see from this graph, the difference of the highest (max) obesity growth state and the lowest (min) growth is high and there is a distinct difference. 

### Population Growth (percentage growth)
```{r, echo=FALSE}
poparrange <- mutateWide %>%
    arrange(desc(pop_growth))
head(poparrange, 5)
tail(poparrange, 6)
```

#### Graph 2: Comparing growth of population of largest and smallest growth
```{r, echo=FALSE}
mergeLong %>%
  filter(type == "Population", Area %in% c("Idaho", "West Virginia"), na.rm = TRUE)%>%
  group_by(Area) %>%
  ggplot(aes(Year, data, col = Area)) +
  geom_line(size = 0.8) +
  labs(x="Years", y="Population from 2015-2022")+
  geom_smooth(method = "lm", se = FALSE, alpha = 0.8, size = 0.2)
```

This graph shows the highest (max) and lowest(min) population growth and the progression from 2015-2022. However, Idaho, the state with the highest growth, also starts with a higher growth compared to the smallest population growth from District of Columbia. 

### Distributions (obesity & population)
#### Graph 3: Histogram: Obesity Growth Distibution
```{r, echo=FALSE}
mutateWide %>%
  filter(na.rm = TRUE)%>%
  group_by(Area) %>%
  ggplot(aes(ob_growth)) +
  geom_histogram(col = "gold1", fill = "green4") 
```

#### Graph 4: Histogram: Population Growth Distibution
```{r, echo=FALSE}
mutateWide %>%
  filter(na.rm = TRUE)%>%
  group_by(Area) %>%
  ggplot(aes(pop_growth)) +
  geom_histogram(col = "gold1", fill = "red3") 
```


#### _**(reference Graph 3 & 4)**_
* _Minnesota_, with the _highest obesity growth_ has a population growth of 29,394, placing it within the middle boundaries of the pop_growth histogram. 
* _District of Columbia_, with the _lowest obesity growth_ has a population growth of -450, placing it within the lower boundaries of the pop_growth histogram. 

* _Idaho_, with the _highest population growth_ has a obesity growth of 0.25, placing it within the middle lower boundaries of the ob_growth histogram. 
* _Wyoming_, with the _lowest population growth_ has a obesity growth of 0.0250, placing it within the lower boundaries of the ob_growth histogram. 

* However if we look at  the _obesity growth ranking_, the states with highest obesity growth have an _overall higher population growth_ to the states with smaller obesity growth. The same cannot be said for the population growth ranking. 


#### Graph 5: Comparing growth of obesity of largest and smallest growth with the obesity growth of the states with highest/lowest population growth. 
```{r, echo=FALSE}
mergeLong %>%
  filter(type == "Obesity", Area %in% c("Minnesota", "District of Columbia", "Idaho", "West Virginia"), na.rm = TRUE)%>%
  group_by(Area) %>%
  ggplot(aes(Year, data, col = Area)) +
  geom_line(size = 0.8) +
  labs(x="Years", y="Obesity from 2015-2022")+
  scale_color_manual(
    values = c("Minnesota" = "blue",
               "District of Columbia" = "blue4",
               "Idaho" = "orange",
               "West Virginia" = "orange3"
    )
  )+
  geom_smooth(method = "lm", se = FALSE, alpha = 0.3, size = 0.5)
```

#### Graph 6: Comparing trends population of largest and smallest growth with the population trends of the states with highest/lowest obesity trends: 
```{r, echo=FALSE}
mergeLong %>%
  filter(type == "Population", Area %in% c("Minnesota", "District of Columbia", "Idaho", "West Virginia"), na.rm = TRUE)%>%
  group_by(Area) %>%
  ggplot(aes(Year, data, col = Area)) +
  geom_line(size = 0.8) +
  labs(x="Years", y="Population from 2015-2022")+
  scale_color_manual(
    values = c("Minnesota" = "blue",
               "District of Columbia" = "blue4",
               "Idaho" = "orange",
               "West Virginia" = "orange3"
    )
  )+
  geom_smooth(method = "lm", se = FALSE, alpha = 0.5, size = 0.2)
```

#### Comparing Growth by state (percentage growth)
```{r, echo=FALSE}
growthCompare <- mutateWide %>%
  mutate(biggerOb = if_else(ob_growth > pop_growth, "True", "False"))%>%
  arrange(desc(ob_growth))
head(growthCompare, 5)
tail(growthCompare, 6)

popGrowCompare <- growthCompare%>%
  arrange(desc(pop_growth))
head(popGrowCompare, 5)
tail(popGrowCompare, 6)

growthCompare %>% 
  count(biggerOb == "True", na.rm = TRUE)

summaryDf <- growthCompare %>%
  select(Area, ob_growth, pop_growth, biggerOb)

summaryDf %>%
  filter(na.rm = TRUE) %>%
  ggplot(aes(ob_growth, pop_growth, col = Area)) +
  geom_point() +
  labs(x = "Obesity Growth Rate (%)",
        y = "Population Growth Rate (%)")+
  geom_smooth(method = "lm", se = FALSE, col = "green4", alpha = 0.5)

```



### Trends
If we look at the states with the highest population growth, only Utah of them appear in the highest obesity growth.
This is the same for the lowest population growth as well, with only Illinois appearing in the lowest obesity growth. 
If we compare the population growth of the states with highest obesity growth: 

**Top 5 obesity growth rate:**

|     State | ob_growth | pop_growth | Obesity > Population growth | 
|  -------- | :------: | :----:       | :----:   |
|Minnesota   |   32.6%   |  4.29%    | True |
|Utah   |   29.4%   |  13.4%    | True |
|Montana   |   28.4%   |  8.97%    | True |
|Ohio   |   24.8&   |  1.19%      | True |
|Wisconsin   |   23.8%   |  2.28%    | True |

**Lowest 5 obesity growth rate:**

|     State | ob_growth | pop_growth |Obesity > Population growth | 
|  -------- | :------: | :----:   | :----:   |
|District of Columbia   |   -2.71%   |  -0.533%    |False |
|Alabama   |   0.562%   |  4.57%    |False |
|Illinois   |   0.649%   |  -2.15%    |True |
|Oregon   |   1.33%   |  5.59%      |False |
|Kansas   |   1.46%   |  0.967%    |True |

**Top 5 population growth rate:**

|     State | pop_growth | ob_growth |Obesity > Population growth | 
|  -------- | :------: | :----:   | :----:   |
|Idaho      |  17.4%    |  16.8%    |False |
|Utah    |  13.4%    |  29.4%    |True |
|Nevada    |  10.8%    |  19.5%    |True |
|Florida |  10.1%    |  20.9%    |True |
|Texas     |  9.32%    |  6.17%    |False |

**Lowest 5 population growth rate:**

|     State | pop_growth | ob_growth |Obesity > Population growth | 
|  -------- | :------: | :----:   |:----:   |
|West Virginia    |  -3.63% |  16.9%    |True |
|Illinois  |  -2.15%   |  0.649%    |True |
|Mississippi    |  -1.62%    |  3.93%    |True |
|Louisiana |  -1.59%    |  3.87%    |True |
|Wyoming     |  -0.723%    |  17.9%    |True |

**Total Overview of Obesity GR > Population GR:**

|     Value | Count | 
|  -------- | :------: |
|True    |  43 |
|False  |  8   | 
|NA    |  1    | 

The state with the _highest rate_ of obesity growth from 2015 - 2022 is **Minnesota**, with a growth rate of 0.326, or 32.6% The runner ups are Utah, and Montana.

The state with the _lowest rate_ of obesity from 2015-2022 is **District of Columbia** with a growth of -0.0271, or -2.71%, the only state with a negative growth of obesity. 

The state with the _highest rate_ of population growth from 2015 - 2022 is **Idaho**, with a growth rate of 0.174, or 17.4%. The runner ups are Utah, Nevada, Florida, and Texas. 

The state with the _lowest rate_ of population growth from 2015 - 2022 is **West Virginia**, with a growth rate of -0.0363, or -3.63% The runner ups are Alabama, Illinois, Oregon, and Kansas. 



### Comparative Trends

* Referencing to **Graph 5**, Idaho, with the highest population growth, has the around the same obesity values and trend as Minnesota, the state with the highest obesity growth rate. West Virginia, with the lowest population growth, has the highest obesity yearly values overall, and higher obesity values compared to Minnesota, the state with the highest obesity growth rate, however not as high as a growth rate.    
* Referencing to **Graph 6**, Minnesota, with the highest obesity growth rate has an overall high population value, despite have a smaller growth rate than Idaho, with the highest growth rate. Despite the graph, the growth rate of Minnesota is 0.0429, 4.29%, and Idaho is 0.174, 17.4%. 

