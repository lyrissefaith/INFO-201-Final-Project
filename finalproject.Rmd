---
title: "finalproject"
output: html_document
date: "2023-11-30"
---
```{r}
library(tidyverse)
```
# Final Project (Population vs. Obesity by State)

## Intro
### Orignial Questions: 
### 1. Are there any correlations between a state’s population size and its obesity percentage? For example, do more populous states tend to have higher or lower obesity rates?


### 2. What is the state with the highest obesity percentage, and how does its population compare to other states with lower obesity rates? Is there a relationship between high obesity and a larger or smaller population?


### 3. Are there any significant changes in state obesity percentages over time, and how do these changes relate to changes in state populations? 


### 4.Are there any states where obesity has been increasing or decreasing at a faster rate compared to changes in population size?


## Data cleaning


### Read in our data and clean population data for 2010-2019

```{r}
pop_2010_2019 <- read_delim("../Data/pop_2010_2019.csv")
short_pop_10_19 <- subset(pop_2010_2019, select = c("Area", "2015", "2016", "2017", "2018", "2019"))
```

### Read in our data and clean population data for 2020-2022

```{r}
pop_2020_2022 <- read_delim("../Data/pop_2020_2022.csv")
short_pop_20_22 <- subset(pop_2020_2022, select = c("NAME", "POPESTIMATE2020", "POPESTIMATE2021", "POPESTIMATE2022"))
colnames(short_pop_20_22) <- c("Area", "2020", "2021", "2022")
```

### Merging population data

```{r}
mergedpop <- left_join(short_pop_10_19, short_pop_20_22)
```

### Cleaning merged population data

```{r}
popLong <- pivot_longer(mergedpop,
                        !c(Area),
                        names_to="Year",
                        values_to="Population") %>%
  mutate(Year = as.numeric(sub("X", "", Year)))
head(popLong, 4)
```

### Read in our data and clean obesity data for 2015-2022

```{r}
obesity_data <- read_delim("../Data/National_Obesity_By_State.csv")
short_obesity_data <- subset(obesity_data, select = c("NAME", "Obesity", "Year"))
colnames(short_obesity_data) <- c("Area","Obesity", "Year")
```

### Merging population and obesity data

```{r}
finalMerge <- left_join(popLong, short_obesity_data) 
```

This is our dataset, population data from 2015-2022 and obesity percentages per state: **mergedObesityPop**. 

## Questions & Data
### 1. Are there any correlations between a state’s population size and its obesity percentage? For example, do more populous states tend to have higher or lower obesity rates?
```{r}
#Highest and lowest obesity percentage per state

ob2015_data <- mergedObesityPop[mergedObesityPop$type == "obesity", ]
ob2015 <- ob2015_data[, "2015"]

highest_obesity_state <- ob2015_data$area[which.max(ob2015)]
highest_obesity_percentage <- max(ob2015)
lowest_obesity_state <- ob2015_data$area[which.min(ob2015)]
lowest_obesity_percentage <- min(ob2015)

cat("The state with the highest obesity percentage in 2015 is", highest_obesity_state, "with a percentage of",  highest_obesity_percentage, "\n")
cat("The state with the lowest obesity percentage in 2015 is", lowest_obesity_state, "with a percentage of", lowest_obesity_percentage, "\n")

#trends up to 2022

years <- as.character(2015:2022)
obesity_trend_data <- obesity_data[, c("area", "type", years)]
find_trend <- function(state) {
  state_data <- obesity_trend_data[obesity_trend_data$area == state, ]
  trend_values <- as.numeric(state_data[, years])
  return(trend_values)
}
calculate_yearly_change <- function(trend_values) {
  annual_change <- c(0, diff(trend_values))
  return(annual_change)
}

highest_obesity_trend <- find_trend(highest_obesity_state)
highest_obesity_annual_change <- calculate_yearly_change(highest_obesity_trend)

lowest_obesity_trend <- find_trend(lowest_obesity_state)
lowest_obesity_annual_change <- calculate_yearly_change(lowest_obesity_trend)

average_annual_change_highest <- mean(highest_obesity_annual_change[2:8])
average_annual_change_lowest <- mean(lowest_obesity_annual_change[2:8])
rounded_high <- round(average_annual_change_highest, digits = 2)
rounded_low <- round(average_annual_change_lowest, digits = 2)

cat("Average annual change in obesity percentage for", highest_obesity_state, "from 2016 to 2022:", rounded_high, "\n")
cat("Average annual change in obesity percentage for", lowest_obesity_state, "from 2016 to 2022:", rounded_low, "\n")

#should I print the original 2015 and 2022 for each of these so I can see that they are increasing regardless?

#if we want to include a plot:
df <- data.frame(
  year = rep(2016:2022, 2),
  state = rep(c(highest_obesity_state, lowest_obesity_state), each = 7),
  annual_change = c(highest_obesity_annual_change[2:8], lowest_obesity_annual_change[2:8])
)

ggplot(df, aes(x = year, y = annual_change, color = state)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +  
  labs(
    title = "Annual Change in Obesity Percentage (2016-2022)",
    x = "Year",
    y = "Annual Change in Obesity Percentage",
    color = "State"
  ) +
  theme_minimal()
```
This data shows that on average, as the years progress, Colorado has decreased their obesity levels by 0.67 and Louisiana continues to increase there obesity percentage by around 0.2.


### 2. What is the state with the highest obesity percentage, and how does its population compare to other states with lower obesity rates? Is there a relationship between high obesity and a larger or smaller population?
```{r}


```


### 3. Are there any significant changes in state obesity percentages over time, and how do these changes relate to changes in state populations? 
#### I'm not sure if this is right because when I do it in another way where I graph outliers, there are no outliers. But when I write the code in this way it shows two states that have outling results. The graph is a straight line slope though, so I don't know if it has no outliers? Might have to re-do after looking at question 2? 

```{r}
# Changes in obesity rates for each state
obesity_changes <- mergedObesityPop %>%
  filter(type == "obesity") %>%
  group_by(area) %>%
  summarise(obesity_change = `2022` - `2015`)

# Changes in population for each area 
population_changes <- mergedObesityPop %>%
  filter(type == "population") %>%
  group_by(area) %>%
  summarise(population_change = `2022` - `2015`)

# Outliers in obesity rate changes
obesity_outliers <- obesity_changes %>%
  filter(abs(scale(obesity_change)) > 2)  

# Merged the population changes with obesity outliers
population_vs_obesity_outliers <- inner_join(population_changes, obesity_outliers, by = "area")
print(population_vs_obesity_outliers)
```
The states with significant outlier changes in obesity rates are District of Columbia and Minnesota. 

District of Columbia had a decrease in population from 2015 to 2022. 
The obesity change - 0.6 indicates a decrease in obesity rate. 
Minnesota saw a big growth in population from 2015 to 2022 resulting in a big increase in obesity rate. 
Increase in population often result in a increase in obesity rate. 

```{r}
ggplot(population_vs_obesity_outliers, aes(x = population_change, y = obesity_change)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(title = "Relationship between Population Change and Obesity Outliers", x = "Population Change", y = "Obesity Change")
```
The graph shows the relation of changes in state populations to chanages in obesity percentates over time. 


### 4.Are there any states where obesity has been increasing or decreasing at a faster rate compared to changes in population size? Does the state with the highest obesity growth have the highest population growth as well? 
```{r}
mergeLong <- finalMerge %>%
  pivot_longer(!Area&!Year, names_to = "type", values_to = "data")

mergeWide <- mergeLong %>%
  pivot_wider(names_from = "Year", values_from = data)

obesity_wide <- mergeWide %>%
  filter(type == "Obesity", na.rm = TRUE)

population_wide <- mergeWide %>%
  filter(type == "Population", na.rm = TRUE)

mutateWide <- obesity_wide %>%
  filter(na.rm = TRUE) %>%
  mutate(obesity_wide, ob_growth = ((obesity_wide$"2022" - obesity_wide$'2015')/8), na.rm = TRUE) %>%
  mutate(population_wide, pop_growth = ((population_wide$"2022" - population_wide$'2015')/8), na.rm = TRUE) %>%
  arrange(desc(ob_growth))%>%
  select(Area, "2015", "2022", ob_growth, pop_growth)
mutateWide

head(mutateWide, 5)
tail(mutateWide, 7)
```

### Obesity Growth
The state with the _highest rate_ of obesity growth from 2015 - 2022 is **Minnesota**, with a growth rate of 1.06. The runner ups are Ohio, with a growth of 0.925, and Wisconsin with a growth of 0.913. 
Top 5 obesity growth rate:    
1 Minnesota      1.06     
2 Ohio           0.925   
3 Wisconsin      0.913     
4 Utah           0.9      
5 Montana        0.837  

The state with the _lowest rate_ of obesity from 2015-2022 is **District of Columbia** with a growth of -0.075, the only state with a negative growth of obesity. 

Lowest 5 obesity growth rate:   
1 Arkansas        0.100   
2 Kansas          0.0625    
3 Oregon          0.0500    
4 Illinois        0.0250    
5 Alabama         0.0250    
6 District of Columbia   -0.0750    

#### Graph 1: Comparing growth of obesity of largest and smallest growth
```{r}
mergeLong %>%
  filter(type == "Obesity", Area %in% c("Minnesota", "District of Columbia"), na.rm = TRUE)%>%
  group_by(Area) %>%
  ggplot(aes(Year, data, col = Area)) +
  geom_line(size = 0.8) +
  labs(x="Years", y="Obesity Growth from 2015-2022")+
  geom_smooth(method = "lm", se = FALSE, alpha = 0.3, size = 0.5)
```

We can see from this graph, the difference of the highest (max) obesity growth state and the lowest (min) growth is high and there is a distinct difference. 

### Population Growth
```{r}
poparrange <- mutateWide %>%
    arrange(desc(pop_growth))
head(poparrange, 5)
tail(poparrange, 6)
```

The state with the _highest rate_ of population growth from 2015 - 2022 is **Texas**, with a growth rate of 319,940. The runner ups are Florida, Georgia, North Carolina, and Washington. 
Top 5 population growth rate: 
1 Texas            319,940
2 Florida          254,473
3 Georgia          91,804
4 North Carolina   83,416
5 Washington       77,766

The state with the _lowest rate_ of population growth from 2015 - 2022 is **Illinois**, with a growth rate of -34,610 The runner ups are Puerto Rico (however note obesity growth is missing), Louisiana, West Virginia, Mississippi, and Wyoming. 
Lowest 5 population growth rate: 
1 Wyoming         -529 
2 Mississippi     -6052
3 West Virginia   -8362
4 Louisiana       -9298
5 Puerto Rico     -31430
6 Illinois        -34610

#### Graph 2: Comparing growth of population of largest and smallest growth
```{r}
mergeLong %>%
  filter(type == "Population", Area %in% c("Texas", "Illinois"), na.rm = TRUE)%>%
  group_by(Area) %>%
  ggplot(aes(Year, data, col = Area)) +
  geom_line(size = 0.8) +
  labs(x="Years", y="Population Growth from 2015-2022")+
  geom_smooth(method = "lm", se = FALSE, alpha = 0.8, size = 0.2)
```

This graph shows the highest (max) and lowest(min) population growth and the progression from 2015-2022. However, Texas, the state with the highest growth, also starts with a higher growth compared to the smallest population growth from District of Columbia. 

### Distributions (obesity & population)
#### Graph 3: Histogram: Obesity Growth Distibution
```{r}
mutateWide %>%
  filter(na.rm = TRUE)%>%
  group_by(Area) %>%
  ggplot(aes(ob_growth)) +
  geom_histogram(col = "gold1", fill = "green4") 
```

#### Graph 4: Histogram: Population Growth Distibution
```{r}
mutateWide %>%
  filter(na.rm = TRUE)%>%
  group_by(Area) %>%
  ggplot(aes(pop_growth)) +
  geom_histogram(col = "gold1", fill = "red3") 
```


### Trends
If we look at the states with the highest population growth, none of them appear in the highest obesity growth.
This is the same for the lowest population growth as well, with none appearing in the lowest obesity growth. 
If we compare the population growth of the states with highest obesity growth: 

**Top 5 obesity growth rate** & population growth:    
Area.           ob_growth.      pop_growth    
1 Minnesota      1.06             29394   
2 Ohio           0.925            17316   
3 Wisconsin      0.913            16450   
4 Utah           0.9              49871   
5 Montana        0.837            11549   

**Lowest 5 obesity growth rate** & population growth:   
Area.           ob_growth.        pop_growth    
1 Arkansas        0.100             8449    
2 Kansas          0.0625            3517    
3 Oregon          0.0500            28043   
4 Illinois        0.0250            -34610    
5 Alabama         0.0250            27744   
6 District of Columbia  -0.0750     -450    


**Top 5 population growth rate** & obesity growth:    
Area.           pop_growth.        ob_growth:     
1 Texas            319,940            0.25      
2 Florida          254,473            0.7   
3 Georgia          91,804             0.425   
4 North Carolina   83,416             0.25    
5 Washington       77,766             0.65    

**Lowest 5 population growth rate** & obesity growth:   
Area.           pop_growth.        ob_growth:     
1 Wyoming         -529                0.65    
2 Mississippi     -6052               0.175   
3 West Virginia   -8362               0.75    
4 Louisiana       -9298               0.175   
5 Puerto Rico     -31430              NA    
6 Illinois        -34610              0.0250    


#### _**(reference Graph 3 & 4)**_
* _Minnesota_, with the _highest obesity growth_ has a population growth of 29,394, placing it within the middle boundaries of the pop_growth histogram. 
* _District of Columbia_, with the _lowest obesity growth_ has a population growth of -450, placing it within the lower boundaries of the pop_growth histogram. 

* _Texas_, with the _highest population growth_ has a obesity growth of 0.25, placing it within the middle lower boundaries of the ob_growth histogram. 
* _Illinois_, with the _lowest population growth_ has a obesity growth of 0.0250, placing it within the lower boundaries of the ob_growth histogram. 

* However if we look at  the _obesity growth ranking_, the states with highest obesity growth have an _overall higher population growth_ to the states with smaller obesity growth. The same cannot be said for the population growth ranking. 


#### Graph 5: Comparing growth of obesity of largest and smallest growth with the obesity growth of the states with highest/lowest population growth. 
```{r}
mergeLong %>%
  filter(type == "Obesity", Area %in% c("Minnesota", "District of Columbia", "Texas", "Illinois"), na.rm = TRUE)%>%
  group_by(Area) %>%
  ggplot(aes(Year, data, col = Area)) +
  geom_line(size = 0.8) +
  labs(x="Years", y="Obesity Growth from 2015-2022")+
  scale_color_manual(
    values = c("Minnesota" = "blue",
               "District of Columbia" = "blue4",
               "Texas" = "orange",
               "Illinois" = "orange3"
    )
  )+
  geom_smooth(method = "lm", se = FALSE, alpha = 0.3, size = 0.5)
```

#### Graph 6: Comparing growth of population of largest and smallest growth with the population growth of the states with highest/lowest obesity growth. 
```{r}
mergeLong %>%
  filter(type == "Population", Area %in% c("Minnesota", "District of Columbia", "Texas", "Illinois"), na.rm = TRUE)%>%
  group_by(Area) %>%
  ggplot(aes(Year, data, col = Area)) +
  geom_line(size = 0.8) +
  labs(x="Years", y="Population Growth from 2015-2022")+
  scale_color_manual(
    values = c("Minnesota" = "blue",
               "District of Columbia" = "blue4",
               "Texas" = "orange",
               "Illinois" = "orange3"
    )
  )+
  geom_smooth(method = "lm", se = FALSE, alpha = 0.8, size = 0.2)
```

### Comparative Trends
If we look specifically to growth trend, we **cannot** find a specific correlation of highest/lowest obesity growth correlating with the highest/lowest population growth. 

* Referencing to **Graph 5**, Texas, with the highest population growth, has the higher obesity growth value. Illinois, with the lowest population growth, has higher obesity values compared to Minnesota, the state with the highest obesity growth rate.    
* Referencing to **Graph 6**, Texas with the highest population growth rate, also has the highest population growth value compared to Minnesota, with the highest obesity growth rate. Illinois, with the lowest population growth rate, has a higher population growth value than Minnesota as well.     




